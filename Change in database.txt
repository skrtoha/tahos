ALTER TABLE `tahos_users` CHANGE `isProvider` `showProvider` INT(1) UNSIGNED NOT NULL DEFAULT '0';

ALTER TABLE `tahos_providers` ADD `workSchedule` JSON NULL DEFAULT NULL AFTER `return_percent`;

ALTER TABLE `tahos_provider_stores` CHANGE `workSchedule` `workSchedule` JSON NULL DEFAULT NULL COMMENT 'график выходных дней, праздников и т.д.';
ALTER TABLE `tahos_provider_stores` ADD `calendar` JSON NULL DEFAULT NULL COMMENT 'график выходных дней, праздников и т.д.' AFTER `workSchedule`;

DROP TABLE IF EXISTS `tahos_required_remains`;
CREATE TABLE IF NOT EXISTS `tahos_required_remains` (
  `item_id` int(10) UNSIGNED NOT NULL,
  `requiredRemain` int(10) UNSIGNED DEFAULT '1',
  PRIMARY KEY (`item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
ALTER TABLE `tahos_required_remains` ADD FOREIGN KEY (`item_id`) REFERENCES `tahos_items`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE `tahos_store_items` ADD `created` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP AFTER `packaging`;

ALTER TABLE `tahos_users` ADD `is_subscribe` INT(1) UNSIGNED NOT NULL DEFAULT '0' AFTER `allow_request_delete_item`, ADD `subscribe_email` VARCHAR(255) NULL DEFAULT NULL AFTER `is_subscribe`, ADD `subscribe_type` VARCHAR(3) NULL DEFAULT NULL AFTER `subscribe_email`;

ALTER TABLE `tahos_providers` ADD `cron_hours` INT(2) UNSIGNED NOT NULL AFTER `is_enabled_api_order`, ADD `cron_minutes` INT(2) UNSIGNED NOT NULL AFTER `cron_hours`;
ALTER TABLE `tahos_providers` CHANGE `cron_hours` `cron_hours` INT(2) UNSIGNED NOT NULL DEFAULT '0', CHANGE `cron_minutes` `cron_minutes` INT(2) UNSIGNED NOT NULL DEFAULT '0';

CREATE TABLE `tahos_subscribe_prices` (
  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  `title` varchar(255) NOT NULL,
  `phone` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `created` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `tahos_subscribe_prices`
--

INSERT INTO `tahos_subscribe_prices` (`email`, `title`, `phone`, `updated`) VALUES
('1111@list.ru', '1111@list.ru', NULL, NULL),
('222@list.ru', '222@list.ru', NULL, NULL),
('333@list.ru', '333@list.ru', NULL, NULL),
('444@list.ru', '444@list.ru', NULL, NULL),
('555@list.ru', '555@list.ru', NULL, NULL),
('6666@list.ru', '6666@list.ru', NULL, NULL),
('666@list.ru', '666@list.ru', NULL, NULL),
('skrtoha@gmail.com', 'Фильтр масляный', '+380503176162', '2020-08-06 14:03:00'),
('skrtohabook111@gmail.com', 'Узел 12', '89148749063', NULL),
('skrtohabook@gmail.com', 'Узел 12', '89148749063', NULL);

SELECT
    @temp := REGEXP_REPLACE(
        URLDECODER(c.url),
        '/search/article/| |/yes|-|,|\\.',
        ''
    ) AS temp,
    i.id,
    @search := regexp_replace(@temp, '/[a-zA-Z -]+', '') as search,
    COUNT(@search) as cnt
FROM
    tahos_connections c
LEFT JOIN
	tahos_items i ON i.article = @search  
WHERE
    c.created BETWEEN '2020-07-01 16:50' AND '2020-08-13 16:50' AND c.url LIKE '/search/article/%'
GROUP BY
	c.url 
ORDER BY
	cnt DESC

  ALTER TABLE `tahos_categories` ADD `isShowOnMainPage` INT(1) UNSIGNED NOT NULL DEFAULT '0' AFTER `parent_id`;

  создать папку categoriess

ALTER TABLE `tahos_provider_stores` DROP `prevail`;

ALTER TABLE `tahos_users`  ADD `markupSettings` JSON NULL DEFAULT NULL  AFTER `subscribe_type`;